/*
MySQL Data Transfer
Source Host: localhost
Source Database: gms
Target Host: localhost
Target Database: gms
Date: 2018/6/5 ĞÇÆÚ¶ş ÏÂÎç 7:41:25
*/

SET FOREIGN_KEY_CHECKS=0;
-- ----------------------------
-- Table structure for adminuser
-- ----------------------------
CREATE TABLE `adminuser` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(128) COLLATE utf8_unicode_ci NOT NULL,
  `nickname` varchar(128) COLLATE utf8_unicode_ci NOT NULL,
  `password` varchar(128) COLLATE utf8_unicode_ci NOT NULL,
  `email` varchar(128) COLLATE utf8_unicode_ci NOT NULL,
  `profile` text COLLATE utf8_unicode_ci,
  `auth_key` varchar(32) COLLATE utf8_unicode_ci NOT NULL,
  `password_hash` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `password_reset_token` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Table structure for auth_assignment
-- ----------------------------
CREATE TABLE `auth_assignment` (
  `item_name` varchar(64) COLLATE utf8_unicode_ci NOT NULL,
  `user_id` varchar(64) COLLATE utf8_unicode_ci NOT NULL,
  `created_at` int(11) DEFAULT NULL,
  PRIMARY KEY (`item_name`,`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Table structure for auth_item
-- ----------------------------
CREATE TABLE `auth_item` (
  `name` varchar(64) COLLATE utf8_unicode_ci NOT NULL,
  `type` int(11) NOT NULL,
  `description` text COLLATE utf8_unicode_ci,
  `rule_name` varchar(64) COLLATE utf8_unicode_ci DEFAULT NULL,
  `data` text COLLATE utf8_unicode_ci,
  `created_at` int(11) DEFAULT NULL,
  `updated_at` int(11) DEFAULT NULL,
  PRIMARY KEY (`name`),
  KEY `rule_name` (`rule_name`),
  KEY `idx-auth_item-type` (`type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Table structure for auth_item_child
-- ----------------------------
CREATE TABLE `auth_item_child` (
  `parent` varchar(64) COLLATE utf8_unicode_ci NOT NULL,
  `child` varchar(64) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`parent`,`child`),
  KEY `child` (`child`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Table structure for auth_rule
-- ----------------------------
CREATE TABLE `auth_rule` (
  `name` varchar(64) COLLATE utf8_unicode_ci NOT NULL,
  `data` text COLLATE utf8_unicode_ci,
  `created_at` int(11) DEFAULT NULL,
  `updated_at` int(11) DEFAULT NULL,
  PRIMARY KEY (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Table structure for comment
-- ----------------------------
CREATE TABLE `comment` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `content` text COLLATE utf8_unicode_ci NOT NULL,
  `status` int(11) NOT NULL,
  `create_time` int(11) DEFAULT NULL,
  `userid` int(11) NOT NULL,
  `email` varchar(128) COLLATE utf8_unicode_ci NOT NULL,
  `url` varchar(128) COLLATE utf8_unicode_ci DEFAULT NULL,
  `post_id` int(11) NOT NULL,
  `remind` int(4) DEFAULT '0' COMMENT '0:æœªæé†’1ï¼šå·²æé†’',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=103 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Table structure for commentstatus
-- ----------------------------
CREATE TABLE `commentstatus` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(128) COLLATE utf8_unicode_ci NOT NULL,
  `position` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Table structure for migration
-- ----------------------------
CREATE TABLE `migration` (
  `version` varchar(180) NOT NULL,
  `apply_time` int(11) DEFAULT NULL,
  PRIMARY KEY (`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Table structure for post
-- ----------------------------
CREATE TABLE `post` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(128) COLLATE utf8_unicode_ci NOT NULL,
  `content` text COLLATE utf8_unicode_ci NOT NULL,
  `tags` text COLLATE utf8_unicode_ci,
  `status` int(11) NOT NULL,
  `create_time` int(11) DEFAULT NULL,
  `update_time` int(11) DEFAULT NULL,
  `author_id` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=38 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Table structure for poststatus
-- ----------------------------
CREATE TABLE `poststatus` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(128) COLLATE utf8_unicode_ci NOT NULL,
  `position` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Table structure for tag
-- ----------------------------
CREATE TABLE `tag` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(128) COLLATE utf8_unicode_ci NOT NULL,
  `frequency` int(11) DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=76 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Table structure for user
-- ----------------------------
CREATE TABLE `user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `auth_key` varchar(32) COLLATE utf8_unicode_ci NOT NULL,
  `password_hash` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `password_reset_token` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
  `email` varchar(255) COLLATE utf8_unicode_ci NOT NULL,
  `status` smallint(6) NOT NULL DEFAULT '10',
  `created_at` int(11) NOT NULL,
  `updated_at` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  UNIQUE KEY `email` (`email`),
  UNIQUE KEY `password_reset_token` (`password_reset_token`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Records 
-- ----------------------------
INSERT INTO `adminuser` VALUES ('1', 'sr', 'è‹A', '$2y$13$RZ20K81ZdERPDyFq2EM31e6KjmmdNRtGmCC6Fq9NST3hWhcgoPqUy', 'webmaster@example.com.cn', 'hello,this is my profile', 'pG7TRyTIXlEbcenpi34TzmMYS2zDsMTF', '$2y$13$4Y5KRDHPFYF.rYumLe6rx.34gBLpK6HROMklh9A8.TZwRFNrM5RyW', null);
INSERT INTO `adminuser` VALUES ('2', 'chengsc', 'ç¨‹æ€åŸ', '$2y$13$RZ20K81ZdERPDyFq2EM31e6KjmmdNRtGmCC6Fq9NST3hWhcgoPqUy', 'tim@u2000.com', 'a testing user', 'pG7TRyTIXlEbcenpi34TzmMYS2zDsMTF', '$2y$13$HtJqGRmc76KIRIwokii8AOQ1XZljXiuWCKUGFnH9vkTnfBpHtqgFu', null);
INSERT INTO `adminuser` VALUES ('3', 'heyx', 'ä½•æ°¸å…´', '$2y$13$RZ20K81ZdERPDyFq2EM31e6KjmmdNRtGmCC6Fq9NST3hWhcgoPqUy', 'heyx@hotmail.com', 'a testing user', 'pG7TRyTIXlEbcenpi34TzmMYS2zDsMTF', '$2y$13$HtJqGRmc76KIRIwokii8AOQ1XZljXiuWCKUGFnH9vkTnfBpHtqgFu', null);
INSERT INTO `adminuser` VALUES ('5', 'testadmin', 'testadmin', '*', 'testinguser@gmail.com', 'test', 'sAivVF-oznEEXaKeSLdJb0_UNAOjq1Dv', '$2y$13$Ac1SRzsv4zuzpmSJSpp32.Xrgub6rnSmOClwf/fr635tz3kD5v3pu', null);
INSERT INTO `adminuser` VALUES ('6', 'dodo', 'dodo', '*', 'testinguser@gmail.com', 'test', 'sAivVF-oznEEXaKeSLdJb0_UNAOjq1Dv', '$2y$13$Ac1SRzsv4zuzpmSJSpp32.Xrgub6rnSmOClwf/fr635tz3kD5v3pu', null);
INSERT INTO `adminuser` VALUES ('7', 'dobest', 'dd', '*', 'su@123.com', '', 'N5hpFTgwRQoBjh6mEq4cyeaHZuE4vGMS', '$2y$13$BZBDm4JfnNeu1jc.ThA4iuyFfA.KQ338ZIOy0IV/Ohyjm0VG.Z6DC', null);
INSERT INTO `auth_assignment` VALUES ('admin', '1', '1527936360');
INSERT INTO `auth_assignment` VALUES ('admin', '7', '1527772378');
INSERT INTO `auth_assignment` VALUES ('commentAuditor', '1', '1527936360');
INSERT INTO `auth_assignment` VALUES ('commentAuditor', '4', '1465177361');
INSERT INTO `auth_assignment` VALUES ('postAdmin', '1', '1527936360');
INSERT INTO `auth_assignment` VALUES ('postAdmin', '2', '1477816632');
INSERT INTO `auth_assignment` VALUES ('postAdmin', '7', '1527772378');
INSERT INTO `auth_assignment` VALUES ('postOperator', '1', '1527936360');
INSERT INTO `auth_assignment` VALUES ('postOperator', '3', '1465177361');
INSERT INTO `auth_item` VALUES ('admin', '1', 'ç³»ç»Ÿç®¡ç†å‘˜', null, null, '1465177361', '1465177361');
INSERT INTO `auth_item` VALUES ('approveComment', '2', 'å®¡æ ¸è¯„è®º', null, null, '1465177361', '1465177361');
INSERT INTO `auth_item` VALUES ('commentAuditor', '1', 'è¯„è®ºå®¡æ ¸å‘˜', null, null, '1465177361', '1465177361');
INSERT INTO `auth_item` VALUES ('createPost', '2', 'æ–°å¢æ–‡ç« ', null, null, '1465177361', '1465177361');
INSERT INTO `auth_item` VALUES ('deletePost', '2', 'åˆ é™¤æ–‡ç« ', null, null, '1465177361', '1465177361');
INSERT INTO `auth_item` VALUES ('postAdmin', '1', 'æ–‡ç« ç®¡ç†å‘˜', null, null, '1465177361', '1465177361');
INSERT INTO `auth_item` VALUES ('postOperator', '1', 'æ–‡ç« æ“ä½œå‘˜', null, null, '1465177361', '1465177361');
INSERT INTO `auth_item` VALUES ('updatePost', '2', 'ä¿®æ”¹æ–‡ç« ', null, null, '1465177361', '1465177361');
INSERT INTO `auth_item_child` VALUES ('commentAuditor', 'approveComment');
INSERT INTO `auth_item_child` VALUES ('admin', 'commentAuditor');
INSERT INTO `auth_item_child` VALUES ('postAdmin', 'createPost');
INSERT INTO `auth_item_child` VALUES ('postAdmin', 'deletePost');
INSERT INTO `auth_item_child` VALUES ('postOperator', 'deletePost');
INSERT INTO `auth_item_child` VALUES ('admin', 'postAdmin');
INSERT INTO `auth_item_child` VALUES ('postAdmin', 'updatePost');
INSERT INTO `comment` VALUES ('88', 'å‡è®¾ä½ æƒ³é€šè¿‡ RESTful é£æ ¼çš„ API æ¥å±•ç¤ºç”¨æˆ·æ•°æ®ã€‚ç”¨æˆ·æ•°æ®è¢«å­˜å‚¨åœ¨ç”¨æˆ·DBè¡¨ï¼Œ ä½ å·²ç»åˆ›å»ºäº† yii\\db\\ActiveRecord ç±» app\\models\\User æ¥è®¿é—®è¯¥ç”¨æˆ·æ•°æ®.', '2', '1443004317', '1', 'sxb@hotmail.com', 'www.wj.com', '41', '1');
INSERT INTO `comment` VALUES ('89', 'yii\\db\\Query::one() æ–¹æ³•åªè¿”å›æŸ¥è¯¢ç»“æœå½“ä¸­çš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œ æ¡ä»¶è¯­å¥ä¸­ä¸ä¼šåŠ ä¸Š LIMIT 1 æ¡ä»¶ã€‚å¦‚æœä½ æ¸…æ¥šçš„çŸ¥é“æŸ¥è¯¢å°†ä¼šåªè¿”å›ä¸€è¡Œæˆ–å‡ è¡Œæ•°æ® ï¼ˆä¾‹å¦‚ï¼Œ å¦‚æœä½ æ˜¯é€šè¿‡æŸäº›ä¸»é”®æ¥æŸ¥è¯¢çš„ï¼‰ï¼Œè¿™å¾ˆå¥½ä¹Ÿæå€¡è¿™æ ·åšã€‚ä½†æ˜¯ï¼Œå¦‚æœæŸ¥è¯¢ç»“æœ æœ‰æœºä¼šè¿”å›å¤§é‡çš„æ•°æ®æ—¶ï¼Œé‚£ä¹ˆä½ åº”è¯¥æ˜¾ç¤ºè°ƒç”¨ limit(1) æ–¹æ³•ï¼Œä»¥æ”¹å–„æ€§èƒ½ã€‚ ä¾‹å¦‚ï¼Œ (new \\yii\\db\\Query())->from(\'user\')->limit(1)->one()ã€‚', '2', '1443004455', '1', 'somuchfun@gmail.com', 'www.wj.com', '39', '1');
INSERT INTO `comment` VALUES ('90', 'ä¼ è¯´ä¸­çš„æ²™å‘', '2', '1443004561', '1', 'lsf@ggoc.com', 'www.wj.com', '34', '1');
INSERT INTO `comment` VALUES ('91', 'å½“ä½ åœ¨è°ƒç”¨ yii\\db\\Query::all() æ–¹æ³•æ—¶ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªä»¥è¿ç»­çš„æ•´å‹æ•°å€¼ä¸ºç´¢å¼•çš„æ•°ç»„ã€‚ è€Œæœ‰æ—¶å€™ä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„å­—æ®µæˆ–è€…è¡¨è¾¾å¼çš„å€¼æ¥ä½œä¸ºç´¢å¼•ç»“æœé›†æ•°ç»„ã€‚é‚£ä¹ˆä½ å¯ä»¥åœ¨è°ƒç”¨ yii\\db\\Query::all() ä¹‹å‰ä½¿ç”¨ yii\\db\\Query::indexBy() æ–¹æ³•æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚', '2', '1443047988', '1', 'ctq@qq.com', 'www.wj.com', '39', '1');
INSERT INTO `comment` VALUES ('92', 'å¦‚éœ€ä½¿ç”¨è¡¨è¾¾å¼çš„å€¼åšä¸ºç´¢å¼•ï¼Œé‚£ä¹ˆåªéœ€è¦ä¼ é€’ä¸€ä¸ªåŒ¿åå‡½æ•°ç»™ yii\\db\\Query::indexBy() æ–¹æ³•å³å¯', '2', '1443049673', '1', 'kiki@qq.com', 'www.wj.com', '36', '1');
INSERT INTO `comment` VALUES ('93', 'yii\\db\\Query::one() æ–¹æ³•åªè¿”å›æŸ¥è¯¢ç»“æœå½“ä¸­çš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œ æ¡ä»¶è¯­å¥ä¸­ä¸ä¼šåŠ ä¸Š LIMIT 1 æ¡', '2', '1443927141', '2', 'csc@bing.com', 'www.wj.com', '39', '1');
INSERT INTO `comment` VALUES ('94', 'ä½ åº”è¯¥åœ¨ å“åº”æ ¼å¼ éƒ¨åˆ†ä¸­è¿‡æ»¤æ‰è¿™äº›å­—æ®µã€‚', '1', '1444267750', '1', 'wj@163.com', 'www.wj.com', '36', '1');
INSERT INTO `comment` VALUES ('95', 'é€‚åˆç”¨å¸¸è§„æ ¼å¼æ˜¾ç¤ºä¸€ä¸ªæ¨¡å‹ï¼ˆä¾‹å¦‚åœ¨ä¸€ä¸ªè¡¨æ ¼çš„ä¸€è¡Œä¸­æ˜¾ç¤ºæ¨¡å‹çš„æ¯ä¸ªå±æ€§ï¼‰ã€‚', '2', '1444377054', '1', 'tester@example.com', 'www.baidu.com', '36', '1');
INSERT INTO `comment` VALUES ('96', 'é­è€å¸ˆï¼Œçœ‹äº†ä½ çš„è§†é¢‘æ·±å…¥æµ…å‡ºï¼Œå—ç›ŠåŒªæµ…ã€‚çœŸçš„éå¸¸éå¸¸æ„Ÿè°¢æ‚¨ï¼', '2', '1479353395', '2', 'mchael@163.com', 'www.wj.com', '35', '1');
INSERT INTO `comment` VALUES ('97', 'è€å¸ˆæƒé™æ§åˆ¶è®²çš„å¾ˆå¥½ï¼Œæƒ³å¬è€å¸ˆè®²ä¸‹ ç®¡ç†å‘˜æ“ä½œæ—¥å¿—å’Œæ•°æ®åº“å¤‡ä»½', '2', '1479353438', '2', 'mchael@163.com', 'www.wj.com', '35', '1');
INSERT INTO `comment` VALUES ('98', 'é­è€å¸ˆ,çœ‹äº†ä½ çš„è§†é¢‘å­¦åˆ°äº†å¾ˆå¤š,çœŸå¿ƒä¸é”™.å’±ä»¬è¿™å¥—è§†é¢‘å­¦å®Œ,æœ‰ç”¨æˆ·æœç´¢æ–‡ç« çš„åŠŸèƒ½ä¹ˆ?', '2', '1479353455', '2', 'mchael@163.com', 'www.wj.com', '42', '1');
INSERT INTO `comment` VALUES ('99', 'é­è€å¸ˆï¼Œçœ‹äº†ä½ çš„è§†é¢‘æ·±å…¥æµ…å‡ºï¼Œå—ç›ŠåŒªæµ…ã€‚çœŸçš„éå¸¸éå¸¸æ„Ÿè°¢æ‚¨ï¼', '1', '1479353617', '2', 'mchael@163.com', 'www.wj.com', '42', '1');
INSERT INTO `comment` VALUES ('100', ' ç‚¹èµï¼Œå­¦ç”Ÿè‡ªå­¦å…šï¼Œå®æˆ˜è¯¾ç¨‹åœ¨å¾ˆå¤šç½‘ç«™éƒ½è¦é’±ã€‚', '1', '1479364784', '2', 'mchael@163.com', 'www.wj.com', '42', '1');
INSERT INTO `comment` VALUES ('101', 'æ‹æ‰‹ç§°å¿«', '1', '1528084576', '1', 'weixi@weixistyle.com', null, '37', '1');
INSERT INTO `comment` VALUES ('102', 'å¤§å¤§å¤§å¤§å¤§å¤§å¤§å¤§å¤§å¤§å¤§å¤§å¤§', '1', '1528189955', '1', 'weixi@weixistyle.com', null, '36', '0');
INSERT INTO `commentstatus` VALUES ('1', 'å¾…å®¡æ ¸', '1');
INSERT INTO `commentstatus` VALUES ('2', 'å·²å®¡æ ¸', '2');
INSERT INTO `migration` VALUES ('m000000_000000_base', '1527497975');
INSERT INTO `migration` VALUES ('m130524_201442_init', '1527497980');
INSERT INTO `post` VALUES ('35', 'Active Record è¯¦è§£ï¼ˆä¸‹ï¼‰', '<div id=\"content\">\r\n\r\n<h2>ARçš„ç”Ÿå‘½å‘¨æœŸ</h2>\r\n<p>ç†è§£ARçš„ç”Ÿå‘½å‘¨æœŸå¯¹äºä½ æ“ä½œæ•°æ®åº“éå¸¸é‡è¦ã€‚ç”Ÿå‘½å‘¨æœŸé€šå¸¸éƒ½ä¼šæœ‰äº›å…¸å‹çš„äº‹ä»¶å­˜åœ¨ã€‚å¯¹äºå¼€å‘ARçš„behaviorsæ¥è¯´éå¸¸æœ‰ç”¨ã€‚</p>\r\n<p>å½“ä½ å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„ARå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†è·å¾—å¦‚ä¸‹çš„ç”Ÿå‘½å‘¨æœŸï¼š</p>\r\n<ol><li>constructor</li>\r\n<li>yii\\db\\ActiveRecord::init(): ä¼šè§¦å‘ä¸€ä¸ª yii\\db\\ActiveRecord::EVENT_INIT äº‹ä»¶</li>\r\n</ol><p>å½“ä½ é€šè¿‡ yii\\db\\ActiveRecord::find() æ–¹æ³•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ¯ä¸ªARå®ä¾‹éƒ½å°†æœ‰ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š</p>\r\n<ol><li>constructor</li>\r\n<li>yii\\db\\ActiveRecord::init(): ä¼šè§¦å‘ä¸€ä¸ª yii\\db\\ActiveRecord::EVENT_INIT äº‹ä»¶</li>\r\n<li>yii\\db\\ActiveRecord::afterFind(): ä¼šè§¦å‘ä¸€ä¸ª yii\\db\\ActiveRecord::EVENT_AFTER_FIND äº‹ä»¶</li>\r\n</ol><p>å½“é€šè¿‡ yii\\db\\ActiveRecord::save() æ–¹æ³•å†™å…¥æˆ–è€…æ›´æ–°æ•°æ®æ—¶, æˆ‘ä»¬å°†è·å¾—å¦‚ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š</p>\r\n<ol><li>yii\\db\\ActiveRecord::beforeValidate(): ä¼šè§¦å‘ä¸€ä¸ª yii\\db\\ActiveRecord::EVENT_BEFORE_VALIDATE äº‹ä»¶</li>\r\n<li>yii\\db\\ActiveRecord::afterValidate(): ä¼šè§¦å‘ä¸€ä¸ª yii\\db\\ActiveRecord::EVENT_AFTER_VALIDATE äº‹ä»¶</li>\r\n<li>yii\\db\\ActiveRecord::beforeSave(): ä¼šè§¦å‘ä¸€ä¸ª yii\\db\\ActiveRecord::EVENT_BEFORE_INSERT æˆ– yii\\db\\ActiveRecord::EVENT_BEFORE_UPDATE äº‹ä»¶</li>\r\n<li>æ‰§è¡Œå®é™…çš„æ•°æ®å†™å…¥æˆ–æ›´æ–°</li>\r\n<li>yii\\db\\ActiveRecord::afterSave(): ä¼šè§¦å‘ä¸€ä¸ª yii\\db\\ActiveRecord::EVENT_AFTER_INSERT æˆ– yii\\db\\ActiveRecord::EVENT_AFTER_UPDATE äº‹ä»¶</li>\r\n</ol><p>æœ€åï¼Œå½“è°ƒç”¨ yii\\db\\ActiveRecord::delete() åˆ é™¤æ•°æ®æ—¶, æˆ‘ä»¬å°†è·å¾—å¦‚ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š</p>\r\n<ol><li>yii\\db\\ActiveRecord::beforeDelete(): ä¼šè§¦å‘ä¸€ä¸ª yii\\db\\ActiveRecord::EVENT_BEFORE_DELETE äº‹ä»¶</li>\r\n<li>æ‰§è¡Œå®é™…çš„æ•°æ®åˆ é™¤</li>\r\n<li>yii\\db\\ActiveRecord::afterDelete(): ä¼šè§¦å‘ä¸€ä¸ª yii\\db\\ActiveRecord::EVENT_AFTER_DELETE äº‹ä»¶</li>\r\n</ol><h2>æŸ¥è¯¢å…³è”çš„æ•°æ®</h2>\r\n<p>ä½¿ç”¨ AR æ–¹æ³•ä¹Ÿå¯ä»¥æŸ¥è¯¢æ•°æ®è¡¨çš„å…³è”æ•°æ®ï¼ˆå¦‚ï¼Œé€‰å‡ºè¡¨Açš„æ•°æ®å¯ä»¥æ‹‰å‡ºè¡¨Bçš„å…³è”æ•°æ®ï¼‰ã€‚\r\næœ‰äº† ARï¼Œ\r\nè¿”å›çš„å…³è”æ•°æ®è¿æ¥å°±åƒè¿æ¥å…³è”ä¸»è¡¨çš„ AR å¯¹è±¡çš„å±æ€§ä¸€æ ·ã€‚</p>\r\n<p>å»ºç«‹å…³è”å…³ç³»åï¼Œé€šè¿‡ <code>$customer-&gt;orders</code> å¯ä»¥è·å–\r\nä¸€ä¸ª <code>Order</code> å¯¹è±¡çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„ä»£è¡¨å½“å‰å®¢æˆ·å¯¹è±¡çš„è®¢å•é›†ã€‚</p>\r\n<p>å®šä¹‰å…³è”å…³ç³»ä½¿ç”¨ä¸€ä¸ªå¯ä»¥è¿”å› yii\\db\\ActiveQuery å¯¹è±¡çš„ getter æ–¹æ³•ï¼Œ\r\nyii\\db\\ActiveQueryå¯¹è±¡æœ‰å…³è”ä¸Šä¸‹æ–‡çš„ç›¸å…³ä¿¡æ¯ï¼Œå› æ­¤å¯ä»¥åªæŸ¥è¯¢å…³è”æ•°æ®ã€‚</p>\r\n<p>ä¾‹å¦‚ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Customer</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getOrders</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-comment\">// å®¢æˆ·å’Œè®¢å•é€šè¿‡ Order.customer_id -&gt; id å…³è”å»ºç«‹ä¸€å¯¹å¤šå…³ç³»</span>\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(Order::className(), [<span class=\"hljs-string\">\'customer_id\'</span> =&gt; <span class=\"hljs-string\">\'id\'</span>]);\r\n    }\r\n}\r\n\r\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Order</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-comment\">// è®¢å•å’Œå®¢æˆ·é€šè¿‡ Customer.id -&gt; customer_id å…³è”å»ºç«‹ä¸€å¯¹ä¸€å…³ç³»</span>\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getCustomer</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasOne(Customer::className(), [<span class=\"hljs-string\">\'id\'</span> =&gt; <span class=\"hljs-string\">\'customer_id\'</span>]);\r\n    }\r\n}\r\n</code></pre>\r\n<p>ä»¥ä¸Šä½¿ç”¨äº† yii\\db\\ActiveRecord::hasMany() å’Œ yii\\db\\ActiveRecord::hasOne() æ–¹æ³•ã€‚\r\nä»¥ä¸Šä¸¤ä¾‹åˆ†åˆ«æ˜¯å…³è”æ•°æ®å¤šå¯¹ä¸€å…³ç³»å’Œä¸€å¯¹ä¸€å…³ç³»çš„å»ºæ¨¡èŒƒä¾‹ã€‚\r\nå¦‚ï¼Œä¸€ä¸ªå®¢æˆ·æœ‰å¾ˆå¤šè®¢å•ï¼Œä¸€ä¸ªè®¢å•åªå½’å±ä¸€ä¸ªå®¢æˆ·ã€‚\r\nä¸¤ä¸ªæ–¹æ³•éƒ½æœ‰ä¸¤ä¸ªå‚æ•°å¹¶è¿”å› yii\\db\\ActiveQuery å¯¹è±¡ã€‚</p>\r\n<ul><li><code>$class</code>ï¼šå…³è”æ¨¡å‹ç±»åï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªå®Œå…¨åˆæ ¼çš„ç±»åã€‚</li>\r\n<li><code>$link</code>: ä¸¤ä¸ªè¡¨çš„å…³è”åˆ—ï¼Œåº”ä¸ºé”®å€¼å¯¹æ•°ç»„çš„å½¢å¼ã€‚\r\næ•°ç»„çš„é”®æ˜¯ <code>$class</code> å…³è”è¡¨çš„åˆ—åï¼Œ\r\nè€Œæ•°ç»„å€¼æ˜¯å…³è”ç±» $class çš„åˆ—åã€‚\r\nåŸºäºè¡¨å¤–é”®å®šä¹‰å…³è”å…³ç³»æ˜¯æœ€ä½³æ–¹æ³•ã€‚</li>\r\n</ul><p>å»ºç«‹å…³è”å…³ç³»åï¼Œè·å–å…³è”æ•°æ®å’Œè·å–ç»„ä»¶å±æ€§ä¸€æ ·ç®€å•ï¼Œ\r\næ‰§è¡Œä»¥ä¸‹ç›¸åº”getteræ–¹æ³•å³å¯ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// å–å¾—å®¢æˆ·çš„è®¢å•</span>\r\n<span class=\"hljs-variable\">$customer</span> = Customer::findOne(<span class=\"hljs-number\">1</span>);\r\n<span class=\"hljs-variable\">$orders</span> = <span class=\"hljs-variable\">$customer</span>-&gt;orders; <span class=\"hljs-comment\">// $orders æ˜¯ Order å¯¹è±¡æ•°ç»„</span>\r\n</code></pre>\r\n<p>ä»¥ä¸Šä»£ç å®é™…æ‰§è¡Œäº†ä»¥ä¸‹ä¸¤æ¡ SQL è¯­å¥ï¼š</p>\r\n<pre><code class=\"language-sql hljs\"><span class=\"hljs-operator\">SELECT * <span class=\"hljs-keyword\">FROM</span> customer <span class=\"hljs-keyword\">WHERE</span> <span class=\"hljs-keyword\">id</span>=<span class=\"hljs-number\">1</span>;</span>\r\n<span class=\"hljs-operator\">SELECT * <span class=\"hljs-keyword\">FROM</span> <span class=\"hljs-keyword\">order</span> <span class=\"hljs-keyword\">WHERE</span> customer_id=<span class=\"hljs-number\">1</span>;</span>\r\n</code></pre>\r\n<blockquote><p>æç¤º:å†æ¬¡ç”¨è¡¨è¾¾å¼ <code>$customer-&gt;orders</code>å°†ä¸ä¼šæ‰§è¡Œç¬¬äºŒæ¬¡ SQL æŸ¥è¯¢ï¼Œ\r\nSQL æŸ¥è¯¢åªåœ¨è¯¥è¡¨è¾¾å¼ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰§è¡Œã€‚\r\næ•°æ®åº“è®¿é—®åªè¿”å›ç¼“å­˜åœ¨å†…éƒ¨å‰ä¸€æ¬¡å–å›çš„ç»“æœé›†ï¼Œå¦‚æœä½ æƒ³æŸ¥è¯¢æ–°çš„\r\nå…³è”æ•°æ®ï¼Œå…ˆè¦æ³¨é”€ç°æœ‰ç»“æœé›†ï¼š<code>unset($customer-&gt;orders);</code>ã€‚</p>\r\n</blockquote>\r\n<p>æœ‰æ—¶å€™éœ€è¦åœ¨å…³è”æŸ¥è¯¢ä¸­ä¼ é€’å‚æ•°ï¼Œå¦‚ä¸éœ€è¦è¿”å›å®¢æˆ·å…¨éƒ¨è®¢å•ï¼Œ\r\nåªéœ€è¦è¿”å›è´­ä¹°é‡‘é¢è¶…è¿‡è®¾å®šå€¼çš„å¤§è®¢å•ï¼Œ\r\né€šè¿‡ä»¥ä¸‹getteræ–¹æ³•å£°æ˜ä¸€ä¸ªå…³è”æ•°æ® <code>bigOrders</code> ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Customer</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getBigOrders</span><span class=\"hljs-params\">(<span class=\"hljs-variable\">$threshold</span> = <span class=\"hljs-number\">100</span>)</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(Order::className(), [<span class=\"hljs-string\">\'customer_id\'</span> =&gt; <span class=\"hljs-string\">\'id\'</span>])\r\n            -&gt;where(<span class=\"hljs-string\">\'subtotal &gt; :threshold\'</span>, [<span class=\"hljs-string\">\':threshold\'</span> =&gt; <span class=\"hljs-variable\">$threshold</span>])\r\n            -&gt;orderBy(<span class=\"hljs-string\">\'id\'</span>);\r\n    }\r\n}\r\n</code></pre>\r\n<p><code>hasMany()</code> è¿”å› yii\\db\\ActiveQuery å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…è®¸ä½ é€šè¿‡\r\nyii\\db\\ActiveQuery æ–¹æ³•å®šåˆ¶æŸ¥è¯¢ã€‚</p>\r\n<p>å¦‚ä¸Šå£°æ˜åï¼Œæ‰§è¡Œ <code>$customer-&gt;bigOrders</code> å°±è¿”å›\r\næ€»é¢å¤§äº100çš„è®¢å•ã€‚ä½¿ç”¨ä»¥ä¸‹ä»£ç æ›´æ”¹è®¾å®šå€¼ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-variable\">$orders</span> = <span class=\"hljs-variable\">$customer</span>-&gt;getBigOrders(<span class=\"hljs-number\">200</span>)-&gt;all();\r\n</code></pre>\r\n<p>&gt;æ³¨æ„ï¼šå…³è”æŸ¥è¯¢è¿”å›çš„æ˜¯ yii\\db\\ActiveQuery çš„å®ä¾‹ï¼Œå¦‚æœåƒç‰¹æ€§ï¼ˆå¦‚ç±»å±æ€§ï¼‰é‚£æ ·è¿æ¥å…³è”æ•°æ®ï¼Œ\r\nè¿”å›çš„ç»“æœæ˜¯å…³è”æŸ¥è¯¢çš„ç»“æœï¼Œå³ yii\\db\\ActiveRecord çš„å®ä¾‹ï¼Œ\r\næˆ–è€…æ˜¯æ•°ç»„ï¼Œæˆ–è€…æ˜¯ null ï¼Œå–å†³äºå…³è”å…³ç³»çš„å¤šæ ·æ€§ã€‚å¦‚ï¼Œ<code>$customer-&gt;getOrders()</code> è¿”å›\r\n<code>ActiveQuery</code> å®ä¾‹ï¼Œè€Œ <code>$customer-&gt;orders</code> è¿”å›<code>Order</code> å¯¹è±¡æ•°ç»„\r\nï¼ˆå¦‚æœæŸ¥è¯¢ç»“æœä¸ºç©ºåˆ™è¿”å›ç©ºæ•°ç»„ï¼‰ã€‚</p>\r\n<h2>ä¸­é—´å…³è”è¡¨</h2>\r\n<p>æœ‰æ—¶ï¼Œä¸¤ä¸ªè¡¨é€šè¿‡ä¸­é—´è¡¨å…³è”ï¼Œå®šä¹‰è¿™æ ·çš„å…³è”å…³ç³»ï¼Œ å¯ä»¥é€šè¿‡è°ƒç”¨ yii\\db\\ActiveQuery::via() æ–¹æ³•æˆ– yii\\db\\ActiveQuery::viaTable() æ–¹æ³•æ¥å®šåˆ¶ yii\\db\\ActiveQuery å¯¹è±¡ ã€‚</p>\r\n<p>ä¸¾ä¾‹è€Œè¨€ï¼Œå¦‚æœ <code>order</code> è¡¨å’Œ <code>item</code> è¡¨é€šè¿‡ä¸­é—´è¡¨ <code>order_item</code> å…³è”èµ·æ¥ï¼Œ å¯ä»¥åœ¨ <code>Order</code> ç±»å£°æ˜ <code>items</code> å…³è”å…³ç³»å–ä»£ä¸­é—´è¡¨ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Order</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getItems</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(Item::className(), [<span class=\"hljs-string\">\'id\'</span> =&gt; <span class=\"hljs-string\">\'item_id\'</span>])\r\n            -&gt;viaTable(<span class=\"hljs-string\">\'order_item\'</span>, [<span class=\"hljs-string\">\'order_id\'</span> =&gt; <span class=\"hljs-string\">\'id\'</span>]);\r\n    }\r\n}\r\n</code></pre>\r\n<p>ä¸¤ä¸ªæ–¹æ³•æ˜¯ç›¸ä¼¼çš„ï¼Œé™¤äº† yii\\db\\ActiveQuery::via() æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½¿ç”¨ AR ç±»ä¸­å®šä¹‰çš„å…³è”åã€‚ ä»¥ä¸Šæ–¹æ³•å–ä»£äº†ä¸­é—´è¡¨ï¼Œç­‰ä»·äºï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Order</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getOrderItems</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(OrderItem::className(), [<span class=\"hljs-string\">\'order_id\'</span> =&gt; <span class=\"hljs-string\">\'id\'</span>]);\r\n    }\r\n\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getItems</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(Item::className(), [<span class=\"hljs-string\">\'id\'</span> =&gt; <span class=\"hljs-string\">\'item_id\'</span>])\r\n            -&gt;via(<span class=\"hljs-string\">\'orderItems\'</span>);\r\n    }\r\n}\r\n</code></pre>\r\n<h2>å»¶è¿ŸåŠ è½½å’Œå³æ—¶åŠ è½½ï¼ˆåˆç§°æƒ°æ€§åŠ è½½ä¸è´ªå©ªåŠ è½½ï¼‰</h2>\r\n<p>å¦‚å‰æ‰€è¿°ï¼Œå½“ä½ ç¬¬ä¸€æ¬¡è¿æ¥å…³è”å¯¹è±¡æ—¶ï¼Œ AR å°†æ‰§è¡Œä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢ æ¥æ£€ç´¢è¯·æ±‚æ•°æ®å¹¶å¡«å……åˆ°å…³è”å¯¹è±¡çš„ç›¸åº”å±æ€§ã€‚ å¦‚æœå†æ¬¡è¿æ¥ç›¸åŒçš„å…³è”å¯¹è±¡ï¼Œä¸å†æ‰§è¡Œä»»ä½•æŸ¥è¯¢è¯­å¥ï¼Œè¿™ç§æ•°æ®åº“æŸ¥è¯¢çš„æ‰§è¡Œæ–¹æ³•ç§°ä¸ºâ€œå»¶è¿ŸåŠ è½½â€ã€‚å¦‚ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// SQL executed: SELECT * FROM customer WHERE id=1</span>\r\n<span class=\"hljs-variable\">$customer</span> = Customer::findOne(<span class=\"hljs-number\">1</span>);\r\n<span class=\"hljs-comment\">// SQL executed: SELECT * FROM order WHERE customer_id=1</span>\r\n<span class=\"hljs-variable\">$orders</span> = <span class=\"hljs-variable\">$customer</span>-&gt;orders;\r\n<span class=\"hljs-comment\">// æ²¡æœ‰ SQL è¯­å¥è¢«æ‰§è¡Œ</span>\r\n<span class=\"hljs-variable\">$orders2</span> = <span class=\"hljs-variable\">$customer</span>-&gt;orders; <span class=\"hljs-comment\">//å–å›ä¸Šæ¬¡æŸ¥è¯¢çš„ç¼“å­˜æ•°æ®</span>\r\n</code></pre>\r\n<p>å»¶è¿ŸåŠ è½½éå¸¸å®ç”¨ï¼Œä½†æ˜¯ï¼Œåœ¨ä»¥ä¸‹åœºæ™¯ä¸­ä½¿ç”¨å»¶è¿ŸåŠ è½½ä¼šé­é‡æ€§èƒ½é—®é¢˜ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// SQL executed: SELECT * FROM customer LIMIT 100</span>\r\n<span class=\"hljs-variable\">$customers</span> = Customer::find()-&gt;limit(<span class=\"hljs-number\">100</span>)-&gt;all();\r\n\r\n<span class=\"hljs-keyword\">foreach</span> (<span class=\"hljs-variable\">$customers</span> <span class=\"hljs-keyword\">as</span> <span class=\"hljs-variable\">$customer</span>) {\r\n    <span class=\"hljs-comment\">// SQL executed: SELECT * FROM order WHERE customer_id=...</span>\r\n    <span class=\"hljs-variable\">$orders</span> = <span class=\"hljs-variable\">$customer</span>-&gt;orders;\r\n    <span class=\"hljs-comment\">// ...å¤„ç† $orders...</span>\r\n}\r\n</code></pre>\r\n<p>å‡è®¾æ•°æ®åº“æŸ¥å‡ºçš„å®¢æˆ·è¶…è¿‡100ä¸ªï¼Œä»¥ä¸Šä»£ç å°†æ‰§è¡Œå¤šå°‘æ¡ SQL è¯­å¥ï¼Ÿ 101 æ¡ï¼ç¬¬ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥å–å›100ä¸ªå®¢æˆ·ï¼Œç„¶åï¼Œ æ¯ä¸ªå®¢æˆ·è¦æ‰§è¡Œä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥ä»¥å–å›è¯¥å®¢æˆ·çš„æ‰€æœ‰è®¢å•ã€‚</p>\r\n<p>ä¸ºè§£å†³ä»¥ä¸Šæ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ yii\\db\\ActiveQuery::with() æ–¹æ³•ä½¿ç”¨å³æ—¶åŠ è½½è§£å†³ã€‚</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// SQL executed: SELECT * FROM customer LIMIT 100;</span>\r\n<span class=\"hljs-comment\">//               SELECT * FROM orders WHERE customer_id IN (1,2,...)</span>\r\n<span class=\"hljs-variable\">$customers</span> = Customer::find()-&gt;limit(<span class=\"hljs-number\">100</span>)\r\n    -&gt;with(<span class=\"hljs-string\">\'orders\'</span>)-&gt;all();\r\n\r\n<span class=\"hljs-keyword\">foreach</span> (<span class=\"hljs-variable\">$customers</span> <span class=\"hljs-keyword\">as</span> <span class=\"hljs-variable\">$customer</span>) {\r\n    <span class=\"hljs-comment\">// æ²¡æœ‰ SQL è¯­å¥è¢«æ‰§è¡Œ</span>\r\n    <span class=\"hljs-variable\">$orders</span> = <span class=\"hljs-variable\">$customer</span>-&gt;orders;\r\n    <span class=\"hljs-comment\">// ...å¤„ç† $orders...</span>\r\n}\r\n</code></pre>\r\n<p>å¦‚ä½ æ‰€è§ï¼ŒåŒæ ·çš„ä»»åŠ¡åªéœ€è¦ä¸¤ä¸ª SQL è¯­å¥ã€‚\r\n&gt;é¡»çŸ¥ï¼šé€šå¸¸ï¼Œå³æ—¶åŠ è½½ N ä¸ªå…³è”å…³ç³»è€Œé€šè¿‡ via() æˆ–è€… viaTable() å®šä¹‰äº† M ä¸ªå…³è”å…³ç³»ï¼Œ å°†æœ‰ 1+M+N æ¡ SQL æŸ¥è¯¢è¯­å¥è¢«æ‰§è¡Œï¼šä¸€ä¸ªæŸ¥è¯¢å–å›ä¸»è¡¨è¡Œæ•°ï¼Œ ä¸€ä¸ªæŸ¥è¯¢ç»™æ¯ä¸€ä¸ª (M) ä¸­é—´è¡¨ï¼Œä¸€ä¸ªæŸ¥è¯¢ç»™æ¯ä¸ª (N) å…³è”è¡¨ã€‚\r\næ³¨æ„:å½“ç”¨å³æ—¶åŠ è½½å®šåˆ¶ select() æ—¶ï¼Œç¡®ä¿è¿æ¥ åˆ°å…³è”æ¨¡å‹çš„åˆ—éƒ½è¢«åŒ…æ‹¬äº†ï¼Œå¦åˆ™ï¼Œå…³è”æ¨¡å‹ä¸ä¼šè½½å…¥ã€‚å¦‚ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-variable\">$orders</span> = Order::find()-&gt;select([<span class=\"hljs-string\">\'id\'</span>, <span class=\"hljs-string\">\'amount\'</span>])-&gt;with(<span class=\"hljs-string\">\'customer\'</span>)-&gt;all();\r\n<span class=\"hljs-comment\">// $orders[0]-&gt;customer æ€»æ˜¯ç©ºçš„ï¼Œä½¿ç”¨ä»¥ä¸‹ä»£ç è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</span>\r\n<span class=\"hljs-variable\">$orders</span> = Order::find()-&gt;select([<span class=\"hljs-string\">\'id\'</span>, <span class=\"hljs-string\">\'amount\'</span>, <span class=\"hljs-string\">\'customer_id\'</span>])-&gt;with(<span class=\"hljs-string\">\'customer\'</span>)-&gt;all();\r\n</code></pre>\r\n<p>æœ‰æ—¶å€™ï¼Œä½ æƒ³è‡ªç”±çš„è‡ªå®šä¹‰å…³è”æŸ¥è¯¢ï¼Œå»¶è¿ŸåŠ è½½å’Œå³æ—¶åŠ è½½éƒ½å¯ä»¥å®ç°ï¼Œå¦‚ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-variable\">$customer</span> = Customer::findOne(<span class=\"hljs-number\">1</span>);\r\n<span class=\"hljs-comment\">// å»¶è¿ŸåŠ è½½: SELECT * FROM order WHERE customer_id=1 AND subtotal&gt;100</span>\r\n<span class=\"hljs-variable\">$orders</span> = <span class=\"hljs-variable\">$customer</span>-&gt;getOrders()-&gt;where(<span class=\"hljs-string\">\'subtotal&gt;100\'</span>)-&gt;all();\r\n\r\n<span class=\"hljs-comment\">// å³æ—¶åŠ è½½: SELECT * FROM customer LIMIT 100</span>\r\n<span class=\"hljs-comment\">//          SELECT * FROM order WHERE customer_id IN (1,2,...) AND subtotal&gt;100</span>\r\n<span class=\"hljs-variable\">$customers</span> = Customer::find()-&gt;limit(<span class=\"hljs-number\">100</span>)-&gt;with([\r\n    <span class=\"hljs-string\">\'orders\'</span> =&gt; <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(<span class=\"hljs-variable\">$query</span>)</span> </span>{\r\n        <span class=\"hljs-variable\">$query</span>-&gt;andWhere(<span class=\"hljs-string\">\'subtotal&gt;100\'</span>);\r\n    },\r\n])-&gt;all();\r\n</code></pre>\r\n<h2>é€†å…³ç³»</h2>\r\n<p>å…³è”å…³ç³»é€šå¸¸æˆå¯¹å®šä¹‰ï¼Œå¦‚ï¼šCustomer å¯ä»¥æœ‰ä¸ªåä¸º orders å…³è”é¡¹ï¼Œ è€Œ Order ä¹Ÿæœ‰ä¸ªåä¸ºcustomer çš„å…³è”é¡¹ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Customer</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    ....\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getOrders</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(Order::className(), [<span class=\"hljs-string\">\'customer_id\'</span> =&gt; <span class=\"hljs-string\">\'id\'</span>]);\r\n    }\r\n}\r\n\r\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Order</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    ....\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getCustomer</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasOne(Customer::className(), [<span class=\"hljs-string\">\'id\'</span> =&gt; <span class=\"hljs-string\">\'customer_id\'</span>]);\r\n    }\r\n}\r\n</code></pre>\r\n<p>å¦‚æœæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼Œå¯ä»¥å‘ç°è®¢å•çš„ customer å’Œ æ‰¾åˆ°è¿™äº›è®¢å•çš„å®¢æˆ·å¯¹è±¡å¹¶ä¸æ˜¯åŒä¸€ä¸ªã€‚è¿æ¥ customer-&gt;orders å°†è§¦å‘ä¸€æ¡ SQL è¯­å¥ è€Œè¿æ¥ä¸€ä¸ªè®¢å•çš„ customer å°†è§¦å‘å¦ä¸€æ¡ SQL è¯­å¥ã€‚</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// SELECT * FROM customer WHERE id=1</span>\r\n<span class=\"hljs-variable\">$customer</span> = Customer::findOne(<span class=\"hljs-number\">1</span>);\r\n<span class=\"hljs-comment\">// è¾“å‡º \"ä¸ç›¸åŒ\"</span>\r\n<span class=\"hljs-comment\">// SELECT * FROM order WHERE customer_id=1</span>\r\n<span class=\"hljs-comment\">// SELECT * FROM customer WHERE id=1</span>\r\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$customer</span>-&gt;orders[<span class=\"hljs-number\">0</span>]-&gt;customer === <span class=\"hljs-variable\">$customer</span>) {\r\n    <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">\'ç›¸åŒ\'</span>;\r\n} <span class=\"hljs-keyword\">else</span> {\r\n    <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">\'ä¸ç›¸åŒ\'</span>;\r\n}\r\n</code></pre>\r\n<p>ä¸ºé¿å…å¤šä½™æ‰§è¡Œçš„åä¸€æ¡è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º customeræˆ– orders å…³è”å…³ç³»å®šä¹‰ç›¸åçš„å…³è”å…³ç³»ï¼Œé€šè¿‡è°ƒç”¨ yii\\db\\ActiveQuery::inverseOf() æ–¹æ³•å¯ä»¥å®ç°ã€‚</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Customer</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    ....\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getOrders</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(Order::className(), [<span class=\"hljs-string\">\'customer_id\'</span> =&gt; <span class=\"hljs-string\">\'id\'</span>])-&gt;inverseOf(<span class=\"hljs-string\">\'customer\'</span>);\r\n    }\r\n}\r\n</code></pre>\r\n<p>ç°åœ¨æˆ‘ä»¬åŒæ ·æ‰§è¡Œä¸Šé¢çš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// SELECT * FROM customer WHERE id=1</span>\r\n<span class=\"hljs-variable\">$customer</span> = Customer::findOne(<span class=\"hljs-number\">1</span>);\r\n<span class=\"hljs-comment\">// è¾“å‡ºç›¸åŒ</span>\r\n<span class=\"hljs-comment\">// SELECT * FROM order WHERE customer_id=1</span>\r\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$customer</span>-&gt;orders[<span class=\"hljs-number\">0</span>]-&gt;customer === <span class=\"hljs-variable\">$customer</span>) {\r\n    <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">\'ç›¸åŒ\'</span>;\r\n} <span class=\"hljs-keyword\">else</span> {\r\n    <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">\'ä¸ç›¸åŒ\'</span>;\r\n}\r\n</code></pre>\r\n<p>ä»¥ä¸Šæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨å»¶è¿ŸåŠ è½½ä¸­ä½¿ç”¨ç›¸å¯¹å…³è”å…³ç³»ï¼Œ ç›¸å¯¹å…³ç³»ä¹Ÿå¯ä»¥ç”¨åœ¨å³æ—¶åŠ è½½ä¸­ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// SELECT * FROM customer</span>\r\n<span class=\"hljs-comment\">// SELECT * FROM order WHERE customer_id IN (1, 2, ...)</span>\r\n<span class=\"hljs-variable\">$customers</span> = Customer::find()-&gt;with(<span class=\"hljs-string\">\'orders\'</span>)-&gt;all();\r\n<span class=\"hljs-comment\">// è¾“å‡ºç›¸åŒ</span>\r\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$customers</span>[<span class=\"hljs-number\">0</span>]-&gt;orders[<span class=\"hljs-number\">0</span>]-&gt;customer === <span class=\"hljs-variable\">$customers</span>[<span class=\"hljs-number\">0</span>]) {\r\n    <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">\'ç›¸åŒ\'</span>;\r\n} <span class=\"hljs-keyword\">else</span> {\r\n    <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">\'ä¸ç›¸åŒ\'</span>;\r\n}\r\n</code></pre>\r\n<p>&gt;æ³¨æ„:ç›¸å¯¹å…³ç³»ä¸èƒ½åœ¨åŒ…å«ä¸­é—´è¡¨çš„å…³è”å…³ç³»ä¸­å®šä¹‰ã€‚ å³æ˜¯ï¼Œå¦‚æœä½ çš„å…³ç³»æ˜¯é€šè¿‡yii\\db\\ActiveQuery::via() æˆ– yii\\db\\ActiveQuery::viaTable()æ–¹æ³•å®šä¹‰çš„ï¼Œ å°±ä¸èƒ½è°ƒç”¨yii\\db\\ActiveQuery::inverseOf()æ–¹æ³•äº†ã€‚</p>\r\n<h2> JOIN ç±»å‹å…³è”æŸ¥è¯¢</h2>\r\n<p>ä½¿ç”¨å…³ç³»æ•°æ®åº“æ—¶ï¼Œæ™®éè¦åšçš„æ˜¯è¿æ¥å¤šä¸ªè¡¨å¹¶æ˜ç¡®åœ°è¿ç”¨å„ç§ JOIN æŸ¥è¯¢ã€‚\r\nJOIN SQLè¯­å¥çš„æŸ¥è¯¢æ¡ä»¶å’Œå‚æ•°ï¼Œä½¿ç”¨ yii\\db\\ActiveQuery::joinWith()\r\nå¯ä»¥é‡ç”¨å·²å®šä¹‰å…³ç³»å¹¶è°ƒç”¨\r\nè€Œä¸æ˜¯ä½¿ç”¨ yii\\db\\ActiveQuery::join() æ¥å®ç°ç›®æ ‡ã€‚</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// æŸ¥æ‰¾æ‰€æœ‰è®¢å•å¹¶ä»¥å®¢æˆ· ID å’Œè®¢å• ID æ’åºï¼Œå¹¶è´ªå©ªåŠ è½½ \"customer\" è¡¨</span>\r\n<span class=\"hljs-variable\">$orders</span> = Order::find()-&gt;joinWith(<span class=\"hljs-string\">\'customer\'</span>)-&gt;orderBy(<span class=\"hljs-string\">\'customer.id, order.id\'</span>)-&gt;all();\r\n<span class=\"hljs-comment\">// æŸ¥æ‰¾åŒ…æ‹¬ä¹¦ç±çš„æ‰€æœ‰è®¢å•ï¼Œå¹¶ä»¥ `INNER JOIN` çš„è¿æ¥æ–¹å¼å³æ—¶åŠ è½½ \"books\" è¡¨</span>\r\n<span class=\"hljs-variable\">$orders</span> = Order::find()-&gt;innerJoinWith(<span class=\"hljs-string\">\'books\'</span>)-&gt;all();\r\n</code></pre>\r\n<p>ä»¥ä¸Šï¼Œæ–¹æ³• yii\\db\\ActiveQuery::innerJoinWith() æ˜¯è®¿é—® <code>INNER JOIN</code> ç±»å‹çš„  yii\\db\\ActiveQuery::joinWith() çš„å¿«æ·æ–¹å¼ã€‚</p>\r\n<p>å¯ä»¥è¿æ¥ä¸€ä¸ªæˆ–å¤šä¸ªå…³è”å…³ç³»ï¼Œå¯ä»¥è‡ªç”±ä½¿ç”¨æŸ¥è¯¢æ¡ä»¶åˆ°å…³è”æŸ¥è¯¢ï¼Œ\r\nä¹Ÿå¯ä»¥åµŒå¥—è¿æ¥å…³è”æŸ¥è¯¢ã€‚å¦‚ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// è¿æ¥å¤šé‡å…³ç³»</span>\r\n<span class=\"hljs-comment\">// æ‰¾å‡º24å°æ—¶å†…æ³¨å†Œå®¢æˆ·åŒ…å«ä¹¦ç±çš„è®¢å•</span>\r\n<span class=\"hljs-variable\">$orders</span> = Order::find()-&gt;innerJoinWith([\r\n    <span class=\"hljs-string\">\'books\'</span>,\r\n    <span class=\"hljs-string\">\'customer\'</span> =&gt; <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-params\">(<span class=\"hljs-variable\">$query</span>)</span> </span>{\r\n        <span class=\"hljs-variable\">$query</span>-&gt;where(<span class=\"hljs-string\">\'customer.created_at &gt; \'</span> . (time() - <span class=\"hljs-number\">24</span> * <span class=\"hljs-number\">3600</span>));\r\n    }\r\n])-&gt;all();\r\n<span class=\"hljs-comment\">// è¿æ¥åµŒå¥—å…³ç³»ï¼šè¿æ¥ books è¡¨åŠå…¶ author åˆ—</span>\r\n<span class=\"hljs-variable\">$orders</span> = Order::find()-&gt;joinWith(<span class=\"hljs-string\">\'books.author\'</span>)-&gt;all();\r\n</code></pre>\r\n<p>ä»£ç èƒŒåï¼Œ Yii å…ˆæ‰§è¡Œä¸€æ¡ JOIN SQL è¯­å¥æŠŠæ»¡è¶³ JOIN SQL è¯­å¥æŸ¥è¯¢æ¡ä»¶çš„ä¸»è¦æ¨¡å‹æŸ¥å‡ºï¼Œ\r\nç„¶åä¸ºæ¯ä¸ªå…³ç³»æ‰§è¡Œä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼Œ\r\nbingå¡«å……ç›¸åº”çš„å…³è”è®°å½•ã€‚</p>\r\n<p>yii\\db\\ActiveQuery::joinWith() å’Œ  yii\\db\\ActiveQuery::with() çš„åŒºåˆ«æ˜¯\r\nå‰è€…è¿æ¥ä¸»æ¨¡å‹ç±»å’Œå…³è”æ¨¡å‹ç±»çš„æ•°æ®è¡¨æ¥æ£€ç´¢ä¸»æ¨¡å‹ï¼Œ\r\nè€Œåè€…åªæŸ¥è¯¢å’Œæ£€ç´¢ä¸»æ¨¡å‹ç±»ã€‚\r\næ£€ç´¢ä¸»æ¨¡å‹</p>\r\n<p>ç”±äºè¿™ä¸ªåŒºåˆ«ï¼Œä½ å¯ä»¥åº”ç”¨åªé’ˆå¯¹ä¸€æ¡ JOIN SQL è¯­å¥èµ·æ•ˆçš„æŸ¥è¯¢æ¡ä»¶ã€‚\r\nå¦‚ï¼Œé€šè¿‡å…³è”æ¨¡å‹çš„æŸ¥è¯¢æ¡ä»¶è¿‡æ»¤ä¸»æ¨¡å‹ï¼Œå¦‚å‰ä¾‹ï¼Œ\r\nå¯ä»¥ä½¿ç”¨å…³è”è¡¨çš„åˆ—æ¥æŒ‘é€‰ä¸»æ¨¡å‹æ•°æ®ï¼Œ</p>\r\n<p>å½“ä½¿ç”¨ yii\\db\\ActiveQuery::joinWith() æ–¹æ³•æ—¶å¯ä»¥å“åº”æ²¡æœ‰æ­§ä¹‰çš„åˆ—åã€‚\r\nIn the above examples, we use <code>item.id</code> and <code>order.id</code> to disambiguate the <code>id</code> column references\r\nå› ä¸ºè®¢å•è¡¨å’Œé¡¹ç›®è¡¨éƒ½åŒ…æ‹¬ <code>id</code> åˆ—ã€‚</p>\r\n<p>å½“è¿æ¥å…³è”å…³ç³»æ—¶ï¼Œå…³è”å…³ç³»é»˜è®¤ä½¿ç”¨å³æ—¶åŠ è½½ã€‚ä½ å¯ä»¥\r\né€šè¿‡ä¼ å‚æ•° <code>$eagerLoading</code> æ¥å†³å®šåœ¨æŒ‡å®šå…³è”æŸ¥è¯¢ä¸­æ˜¯å¦ä½¿ç”¨å³æ—¶åŠ è½½ã€‚</p>\r\n<p>é»˜è®¤ yii\\db\\ActiveQuery::joinWith() ä½¿ç”¨å·¦è¿æ¥æ¥è¿æ¥å…³è”è¡¨ã€‚\r\nä½ ä¹Ÿå¯ä»¥ä¼  <code>$joinType</code> å‚æ•°æ¥å®šåˆ¶è¿æ¥ç±»å‹ã€‚\r\nä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ yii\\db\\ActiveQuery::innerJoinWith()ã€‚</p>\r\n<p>ä»¥ä¸‹æ˜¯ <code>INNER JOIN</code> çš„ç®€çŸ­ä¾‹å­ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// æŸ¥æ‰¾åŒ…æ‹¬ä¹¦ç±çš„æ‰€æœ‰è®¢å•ï¼Œä½† \"books\" è¡¨ä¸ä½¿ç”¨å³æ—¶åŠ è½½</span>\r\n<span class=\"hljs-variable\">$orders</span> = Order::find()-&gt;innerJoinWith(<span class=\"hljs-string\">\'books\'</span>, <span class=\"hljs-keyword\">false</span>)-&gt;all();\r\n<span class=\"hljs-comment\">// ç­‰ä»·äºï¼š</span>\r\n<span class=\"hljs-variable\">$orders</span> = Order::find()-&gt;joinWith(<span class=\"hljs-string\">\'books\'</span>, <span class=\"hljs-keyword\">false</span>, <span class=\"hljs-string\">\'INNER JOIN\'</span>)-&gt;all();\r\n</code></pre>\r\n<p>æœ‰æ—¶è¿æ¥ä¸¤ä¸ªè¡¨æ—¶ï¼Œéœ€è¦åœ¨å…³è”æŸ¥è¯¢çš„ ON éƒ¨åˆ†æŒ‡å®šé¢å¤–æ¡ä»¶ã€‚\r\nè¿™å¯ä»¥é€šè¿‡è°ƒç”¨ yii\\db\\ActiveQuery::onCondition() æ–¹æ³•å®ç°ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">User</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getBooks</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(Item::className(), [<span class=\"hljs-string\">\'owner_id\'</span> =&gt; <span class=\"hljs-string\">\'id\'</span>])-&gt;onCondition([<span class=\"hljs-string\">\'category_id\'</span> =&gt; <span class=\"hljs-number\">1</span>]);\r\n    }\r\n}\r\n</code></pre>\r\n<p>åœ¨ä¸Šé¢ï¼Œ yii\\db\\ActiveRecord::hasMany() æ–¹æ³•å›ä¼ äº†ä¸€ä¸ª yii\\db\\ActiveQuery å¯¹è±¡ï¼Œ\r\nå½“ä½ ç”¨ yii\\db\\ActiveQuery::joinWith() æ‰§è¡Œä¸€æ¡æŸ¥è¯¢æ—¶ï¼Œå–å†³äºæ­£è¢«è°ƒç”¨çš„æ˜¯å“ªä¸ª yii\\db\\ActiveQuery::onCondition()ï¼Œ\r\nè¿”å› <code>category_id</code> ä¸º 1 çš„ items </p>\r\n<p>å½“ä½ ç”¨ yii\\db\\ActiveQuery::joinWith() è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢æ—¶ï¼Œâ€œon-conditionâ€æ¡ä»¶ä¼šè¢«æ”¾ç½®åœ¨ç›¸åº”æŸ¥è¯¢è¯­å¥çš„ ON éƒ¨åˆ†ï¼Œ\r\nå¦‚ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// SELECT user.* FROM user LEFT JOIN item ON item.owner_id=user.id AND category_id=1</span>\r\n<span class=\"hljs-comment\">// SELECT * FROM item WHERE owner_id IN (...) AND category_id=1</span>\r\n<span class=\"hljs-variable\">$users</span> = User::find()-&gt;joinWith(<span class=\"hljs-string\">\'books\'</span>)-&gt;all();\r\n</code></pre>\r\n<p>æ³¨æ„ï¼šå¦‚æœé€šè¿‡ yii\\db\\ActiveQuery::with() è¿›è¡Œè´ªå©ªåŠ è½½æˆ–ä½¿ç”¨æƒ°æ€§åŠ è½½çš„è¯ï¼Œåˆ™ on æ¡ä»¶ä¼šè¢«æ”¾ç½®åœ¨å¯¹åº” SQLè¯­å¥çš„ <code>WHERE</code> éƒ¨åˆ†ã€‚\r\nå› ä¸ºï¼Œæ­¤æ—¶æ­¤å¤„å¹¶æ²¡æœ‰å‘ç”Ÿ JOIN æŸ¥è¯¢ã€‚æ¯”å¦‚ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-comment\">// SELECT * FROM user WHERE id=10</span>\r\n<span class=\"hljs-variable\">$user</span> = User::findOne(<span class=\"hljs-number\">10</span>);\r\n<span class=\"hljs-comment\">// SELECT * FROM item WHERE owner_id=10 AND category_id=1</span>\r\n<span class=\"hljs-variable\">$books</span> = <span class=\"hljs-variable\">$user</span>-&gt;books;\r\n</code></pre>\r\n<h2>å…³è”è¡¨æ“ä½œ</h2>\r\n<p>AR æä¾›äº†ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•ç”¨æ¥å»ºç«‹å’Œè§£é™¤ä¸¤ä¸ªå…³è”å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼š</p>\r\n<ul><li>yii\\db\\ActiveRecord::link()</li>\r\n<li>yii\\db\\ActiveRecord::unlink()</li>\r\n</ul><p>ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªcustomerå’Œorderå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç ä½¿å¾—customerå¯¹è±¡æ‹¥æœ‰orderå¯¹è±¡ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-variable\">$customer</span> = Customer::findOne(<span class=\"hljs-number\">1</span>);\r\n<span class=\"hljs-variable\">$order</span> = <span class=\"hljs-keyword\">new</span> Order();\r\n<span class=\"hljs-variable\">$order</span>-&gt;subtotal = <span class=\"hljs-number\">100</span>;\r\n<span class=\"hljs-variable\">$customer</span>-&gt;link(<span class=\"hljs-string\">\'orders\'</span>, <span class=\"hljs-variable\">$order</span>);\r\n</code></pre>\r\n<p>yii\\db\\ActiveRecord::link() è°ƒç”¨ä¸Šè¿°å°†è®¾ç½® customer_id çš„é¡ºåºæ˜¯ $customer çš„ä¸»é”®å€¼ï¼Œç„¶åè°ƒç”¨ yii\\db\\ActiveRecord::save() è¦å°†é¡ºåºä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p>\r\n<h2>ä½œç”¨åŸŸ</h2>\r\n<p>å½“ä½ è°ƒç”¨yii\\db\\ActiveRecord::find() æˆ– yii\\db\\ActiveRecord::findBySql()æ–¹æ³•æ—¶ï¼Œå°†ä¼šè¿”å›ä¸€ä¸ªyii\\db\\ActiveQueryå®ä¾‹ã€‚ä¹‹åï¼Œä½ å¯ä»¥è°ƒç”¨å…¶ä»–æŸ¥è¯¢æ–¹æ³•ï¼Œå¦‚ yii\\db\\ActiveQuery::where()ï¼Œyii\\db\\ActiveQuery::orderBy(), è¿›ä¸€æ­¥çš„æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ã€‚</p>\r\n<p>æœ‰æ—¶å€™ä½ å¯èƒ½éœ€è¦åœ¨ä¸åŒçš„åœ°æ–¹ä½¿ç”¨ç›¸åŒçš„æŸ¥è¯¢æ–¹æ³•ã€‚å¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼Œä½ åº”è¯¥è€ƒè™‘å®šä¹‰æ‰€è°“çš„ä½œç”¨åŸŸã€‚ä½œç”¨åŸŸæ˜¯æœ¬è´¨ä¸Šè¦æ±‚ä¸€ç»„çš„æŸ¥è¯¢æ–¹æ³•æ¥ä¿®æ”¹æŸ¥è¯¢å¯¹è±¡çš„è‡ªå®šä¹‰æŸ¥è¯¢ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚ ä¹‹åä½ å°±å¯ä»¥åƒä½¿ç”¨æ™®é€šæ–¹æ³•ä¸€æ ·ä½¿ç”¨ä½œç”¨åŸŸã€‚</p>\r\n<p>åªéœ€ä¸¤æ­¥å³å¯å®šä¹‰ä¸€ä¸ªä½œç”¨åŸŸã€‚é¦–å…ˆç»™ä½ çš„modelåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æŸ¥è¯¢ç±»ï¼Œåœ¨æ­¤ç±»ä¸­å®šä¹‰çš„æ‰€éœ€çš„èŒƒå›´æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œç»™Commentæ¨¡å‹åˆ›å»ºä¸€ä¸ª CommentQueryç±»ï¼Œç„¶ååœ¨CommentQueryç±»ä¸­å®šä¹‰ä¸€ä¸ªactive()çš„æ–¹æ³•ä¸ºä½œç”¨åŸŸï¼Œåƒä¸‹é¢çš„ä»£ç ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-title\">app</span>\\<span class=\"hljs-title\">models</span>;\r\n\r\n<span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveQuery</span>;\r\n\r\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CommentQuery</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">ActiveQuery</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">active</span><span class=\"hljs-params\">(<span class=\"hljs-variable\">$state</span> = true)</span>\r\n    </span>{\r\n        <span class=\"hljs-variable\">$this</span>-&gt;andWhere([<span class=\"hljs-string\">\'active\'</span> =&gt; <span class=\"hljs-variable\">$state</span>]);\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>;\r\n    }\r\n}\r\n</code></pre>\r\n<p>é‡ç‚¹:</p>\r\n<ol><li>ç±»å¿…é¡»ç»§æ‰¿ yii\\db\\ActiveQuery (æˆ–è€…æ˜¯å…¶ä»–çš„ ActiveQuery ï¼Œæ¯”å¦‚ yii\\mongodb\\ActiveQuery)ã€‚</li>\r\n<li>å¿…é¡»æ˜¯ä¸€ä¸ªpublicç±»å‹çš„æ–¹æ³•ä¸”å¿…é¡»è¿”å› $this å®ç°é“¾å¼æ“ä½œã€‚å¯ä»¥ä¼ å…¥å‚æ•°ã€‚</li>\r\n<li>æ£€æŸ¥ yii\\db\\ActiveQuery å¯¹äºä¿®æ”¹æŸ¥è¯¢æ¡ä»¶æ˜¯éå¸¸æœ‰ç”¨çš„æ–¹æ³•ã€‚</li>\r\n</ol><p>å…¶æ¬¡ï¼Œè¦†ç›–yii\\db\\ActiveRecord::find() æ–¹æ³•ä½¿å…¶è¿”å›è‡ªå®šä¹‰çš„æŸ¥è¯¢å¯¹è±¡è€Œä¸æ˜¯å¸¸è§„çš„yii\\db\\ActiveQueryã€‚å¯¹äºä¸Šè¿°ä¾‹å­ï¼Œä½ éœ€è¦ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-title\">app</span>\\<span class=\"hljs-title\">models</span>;\r\n\r\n<span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>;\r\n\r\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Comment</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-comment\">/**\r\n     * <span class=\"hljs-doctag\">@inheritdoc</span>\r\n     * <span class=\"hljs-doctag\">@return</span> CommentQuery\r\n     */</span>\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">find</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> CommentQuery(get_called_class());\r\n    }\r\n}\r\n</code></pre>\r\n<p>å°±è¿™æ ·ï¼Œç°åœ¨ä½ å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ä½œç”¨åŸŸæ–¹æ³•äº†ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-variable\">$comments</span> = Comment::find()-&gt;active()-&gt;all();\r\n<span class=\"hljs-variable\">$inactiveComments</span> = Comment::find()-&gt;active(<span class=\"hljs-keyword\">false</span>)-&gt;all();\r\n</code></pre>\r\n<p>ä½ ä¹Ÿèƒ½åœ¨å®šä¹‰çš„å…³è”é‡Œä½¿ç”¨ä½œç”¨åŸŸæ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Post</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getActiveComments</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(Comment::className(), [<span class=\"hljs-string\">\'post_id\'</span> =&gt; <span class=\"hljs-string\">\'id\'</span>])-&gt;active();\r\n\r\n    }\r\n}\r\n</code></pre>\r\n<p>æˆ–è€…åœ¨æ‰§è¡Œå…³è”æŸ¥è¯¢çš„æ—¶å€™ä½¿ç”¨ï¼ˆon-the-fly æ˜¯å•¥ï¼Ÿï¼‰ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-variable\">$posts</span> = Post::find()-&gt;with([\r\n    <span class=\"hljs-string\">\'comments\'</span> =&gt; <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(<span class=\"hljs-variable\">$q</span>)</span> </span>{\r\n        <span class=\"hljs-variable\">$q</span>-&gt;active();\r\n    }\r\n])-&gt;all();\r\n</code></pre>\r\n<h3>é»˜è®¤ä½œç”¨åŸŸ</h3>\r\n<p>å¦‚æœä½ ä¹‹å‰ç”¨è¿‡ Yii 1.1 å°±åº”è¯¥çŸ¥é“é»˜è®¤ä½œç”¨åŸŸçš„æ¦‚å¿µã€‚ä¸€ä¸ªé»˜è®¤çš„ä½œç”¨åŸŸå¯ä»¥ä½œç”¨äºæ‰€æœ‰æŸ¥è¯¢ã€‚ä½ å¯ä»¥å¾ˆå®¹æ˜“çš„é€šè¿‡é‡å†™yii\\db\\ActiveRecord::find()æ–¹æ³•æ¥å®šä¹‰ä¸€ä¸ªé»˜è®¤ä½œç”¨åŸŸï¼Œä¾‹å¦‚ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">find</span><span class=\"hljs-params\">()</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">parent</span>::find()-&gt;where([<span class=\"hljs-string\">\'deleted\'</span> =&gt; <span class=\"hljs-keyword\">false</span>]);\r\n}\r\n</code></pre>\r\n<p>æ³¨æ„ï¼Œä½ ä¹‹åæ‰€æœ‰çš„æŸ¥è¯¢éƒ½ä¸èƒ½ç”¨ yii\\db\\ActiveQuery::where()ï¼Œä½†æ˜¯å¯ä»¥ç”¨ yii\\db\\ActiveQuery::andWhere() å’Œ yii\\db\\ActiveQuery::orWhere()ï¼Œä»–ä»¬ä¸ä¼šè¦†ç›–æ‰é»˜è®¤ä½œç”¨åŸŸã€‚ï¼ˆè¯‘æ³¨ï¼šå¦‚æœä½ è¦ä½¿ç”¨é»˜è®¤ä½œç”¨åŸŸï¼Œå°±ä¸èƒ½åœ¨ xxx::find()åä½¿ç”¨where()æ–¹æ³•ï¼Œä½ å¿…é¡»ä½¿ç”¨andXXX()æˆ–è€…orXXX()ç³»çš„æ–¹æ³•ï¼Œå¦åˆ™é»˜è®¤ä½œç”¨åŸŸä¸ä¼šèµ·æ•ˆæœï¼Œè‡³äºåŸå› ï¼Œæ‰“å¼€where()æ–¹æ³•çš„ä»£ç ä¸€çœ‹ä¾¿çŸ¥ï¼‰</p>\r\n<h2>äº‹åŠ¡æ“ä½œ</h2>\r\n<p>å½“æ‰§è¡Œå‡ ä¸ªç›¸å…³è”çš„æ•°æ®åº“æ“ä½œçš„æ—¶å€™</p>\r\n<p>TODO: FIXME: WIP, TBD, <a href=\"https://github.com/yiisoft/yii2/issues/226\">https://github.com/yiisoft/yii2/issues/226</a></p>\r\n<p>, yii\\db\\ActiveRecord::afterSave(), yii\\db\\ActiveRecord::beforeDelete() and/or yii\\db\\ActiveRecord::afterDelete() ç”Ÿå‘½å‘¨æœŸå‘¨æœŸæ–¹æ³•(life cycle methods æˆ‘è§‰å¾—è¿™å¥ç¿»è¯‘æˆâ€œæ¨¡æ¿æ–¹æ³•â€ä¼šä¸ä¼šæ›´å¥½ç‚¹ï¼Ÿ)ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡é‡å†™yii\\db\\ActiveRecord::save()æ–¹æ³•ç„¶ååœ¨æ§åˆ¶å™¨é‡Œä½¿ç”¨äº‹åŠ¡æ“ä½œï¼Œä¸¥æ ¼åœ°è¯´æ˜¯ä¼¼ä¹ä¸æ˜¯ä¸€ä¸ªå¥½çš„åšæ³• ï¼ˆå¬å›\"ç˜¦æ§åˆ¶å™¨ / è‚¥æ¨¡å‹\"åŸºæœ¬è§„åˆ™ï¼‰ã€‚</p>\r\n<p>è¿™äº›æ–¹æ³•åœ¨è¿™é‡Œ(å¦‚æœä½ ä¸æ˜ç™½è‡ªå·±å®é™…åœ¨å¹²ä»€ä¹ˆï¼Œè¯·ä¸è¦ä½¿ç”¨ä»–ä»¬)ï¼ŒModelsï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Feature</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-comment\">// ...</span>\r\n\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getProduct</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasOne(Product::className(), [<span class=\"hljs-string\">\'id\'</span> =&gt; <span class=\"hljs-string\">\'product_id\'</span>]);\r\n    }\r\n}\r\n\r\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Product</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-comment\">// ...</span>\r\n\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getFeatures</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(Feature::className(), [<span class=\"hljs-string\">\'product_id\'</span> =&gt; <span class=\"hljs-string\">\'id\'</span>]);\r\n    }\r\n}\r\n</code></pre>\r\n<p>é‡å†™ yii\\db\\ActiveRecord::save() æ–¹æ³•ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ProductController</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">web</span>\\<span class=\"hljs-title\">Controller</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">actionCreate</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-comment\">// <span class=\"hljs-doctag\">FIXME:</span> <span class=\"hljs-doctag\">TODO:</span> WIP, TBD</span>\r\n    }\r\n}\r\n</code></pre>\r\n<p>(è¯‘æ³¨ï¼šæˆ‘è§‰å¾—ä¸Šé¢åº”è¯¥æ˜¯åŸæ‰‹å†Œé‡Œçš„bug)</p>\r\n<p>åœ¨æ§åˆ¶å™¨å±‚ä½¿ç”¨äº‹åŠ¡ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ProductController</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">web</span>\\<span class=\"hljs-title\">Controller</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">actionCreate</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-comment\">// <span class=\"hljs-doctag\">FIXME:</span> <span class=\"hljs-doctag\">TODO:</span> WIP, TBD</span>\r\n    }\r\n}\r\n</code></pre>\r\n<p>ä½œä¸ºè¿™äº›è„†å¼±æ–¹æ³•çš„æ›¿ä»£ï¼Œä½ åº”è¯¥ä½¿ç”¨åŸå­æ“ä½œæ–¹æ¡ˆç‰¹æ€§ã€‚</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Feature</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-comment\">// ...</span>\r\n\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getProduct</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasOne(Product::className(), [<span class=\"hljs-string\">\'product_id\'</span> =&gt; <span class=\"hljs-string\">\'id\'</span>]);\r\n    }\r\n\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">scenarios</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> [\r\n            <span class=\"hljs-string\">\'userCreates\'</span> =&gt; [\r\n                <span class=\"hljs-string\">\'attributes\'</span> =&gt; [<span class=\"hljs-string\">\'name\'</span>, <span class=\"hljs-string\">\'value\'</span>],\r\n                <span class=\"hljs-string\">\'atomic\'</span> =&gt; [<span class=\"hljs-keyword\">self</span>::OP_INSERT],\r\n            ],\r\n        ];\r\n    }\r\n}\r\n\r\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Product</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">db</span>\\<span class=\"hljs-title\">ActiveRecord</span>\r\n</span>{\r\n    <span class=\"hljs-comment\">// ...</span>\r\n\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getFeatures</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable\">$this</span>-&gt;hasMany(Feature::className(), [<span class=\"hljs-string\">\'id\'</span> =&gt; <span class=\"hljs-string\">\'product_id\'</span>]);\r\n    }\r\n\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">scenarios</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">return</span> [\r\n            <span class=\"hljs-string\">\'userCreates\'</span> =&gt; [\r\n                <span class=\"hljs-string\">\'attributes\'</span> =&gt; [<span class=\"hljs-string\">\'title\'</span>, <span class=\"hljs-string\">\'price\'</span>],\r\n                <span class=\"hljs-string\">\'atomic\'</span> =&gt; [<span class=\"hljs-keyword\">self</span>::OP_INSERT],\r\n            ],\r\n        ];\r\n    }\r\n\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">afterValidate</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">parent</span>::afterValidate();\r\n        <span class=\"hljs-comment\">// <span class=\"hljs-doctag\">FIXME:</span> <span class=\"hljs-doctag\">TODO:</span> WIP, TBD</span>\r\n    }\r\n\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">afterSave</span><span class=\"hljs-params\">(<span class=\"hljs-variable\">$insert</span>)</span>\r\n    </span>{\r\n        <span class=\"hljs-keyword\">parent</span>::afterSave(<span class=\"hljs-variable\">$insert</span>);\r\n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$this</span>-&gt;getScenario() === <span class=\"hljs-string\">\'userCreates\'</span>) {\r\n            <span class=\"hljs-comment\">// <span class=\"hljs-doctag\">FIXME:</span> <span class=\"hljs-doctag\">TODO:</span> WIP, TBD</span>\r\n        }\r\n    }\r\n}\r\n</code></pre>\r\n<p>Controlleré‡Œçš„ä»£ç å°†å˜å¾—å¾ˆç®€æ´ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ProductController</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">web</span>\\<span class=\"hljs-title\">Controller</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">actionCreate</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-comment\">// <span class=\"hljs-doctag\">FIXME:</span> <span class=\"hljs-doctag\">TODO:</span> WIP, TBD</span>\r\n    }\r\n}\r\n</code></pre>\r\n<p>æ§åˆ¶å™¨éå¸¸ç®€æ´ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ProductController</span> <span class=\"hljs-keyword\">extends</span> \\<span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">web</span>\\<span class=\"hljs-title\">Controller</span>\r\n</span>{\r\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">actionCreate</span><span class=\"hljs-params\">()</span>\r\n    </span>{\r\n        <span class=\"hljs-comment\">// <span class=\"hljs-doctag\">FIXME:</span> <span class=\"hljs-doctag\">TODO:</span> WIP, TBD</span>\r\n    }\r\n}\r\n</code></pre>\r\n<h2>ä¹è§‚é”ï¼ˆOptimistic Locksï¼‰</h2>\r\n<p>TODO</p>\r\n<h2>è¢«æ±¡æŸ“å±æ€§</h2>\r\n<p>å½“ä½ è°ƒç”¨yii\\db\\ActiveRecord::save()ç”¨äºä¿å­˜æ´»åŠ¨è®°å½•(Active Record)å®ä¾‹æ—¶,åªæœ‰è¢«æ±¡æŸ“çš„å±æ€§æ‰ä¼šè¢«ä¿å­˜ã€‚ä¸€ä¸ªå±æ€§æ˜¯å¦è®¤å®šä¸ºè¢«æ±¡æŸ“å–å†³äºå®ƒçš„å€¼è‡ªä»æœ€åä¸€æ¬¡ä»æ•°æ®åº“åŠ è½½æˆ–è€…æœ€è¿‘ä¸€æ¬¡ä¿å­˜åˆ°æ•°æ®åº“ååˆ°ç°åœ¨æ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚æ³¨æ„:æ— è®ºæ´»åŠ¨è®°å½•(Active Record)æ˜¯å¦æœ‰è¢«æ±¡æŸ“å±æ€§ï¼Œæ•°æ®éªŒè¯å§‹ç»ˆä¼šæ‰§è¡Œã€‚</p>\r\n<p>æ´»åŠ¨è®°å½•(Active Record)ä¼šè‡ªåŠ¨ç»´æŠ¤ä¸€ä¸ªæ±¡æŸ“æ•°æ®åˆ—è¡¨ã€‚å®ƒçš„å·¥ä½œæ–¹å¼æ˜¯é€šè¿‡ç»´æŠ¤ä¸€ä¸ªè¾ƒæ—§å±æ€§å€¼ç‰ˆæœ¬ï¼Œå¹¶ä¸”å°†å®ƒä»¬ä¸æœ€æ–°çš„è¿›è¡Œæ¯”è¾ƒã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨yii\\db\\ActiveRecord::getDirtyAttributes()æ¥è·å–å½“å‰çš„æ±¡æŸ“å±æ€§ã€‚ä½ ä¹Ÿå¯ä»¥è°ƒç”¨yii\\db\\ActiveRecord::markAttributeDirty()æ¥æ˜¾ç¤ºçš„æ ‡è®°ä¸€ä¸ªå±æ€§ä¸ºæ±¡æŸ“å±æ€§ã€‚</p>\r\n<p>å¦‚æœä½ å¯¹æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹å‰çš„å±æ€§å€¼æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥è°ƒç”¨yii\\db\\ActiveRecord::getOldAttributes() æˆ– yii\\db\\ActiveRecord::getOldAttribute()ã€‚</p>\r\n<h2>å¦è§</h2>\r\n<ul><li><a href=\"/doc/guide/2.0/model\">æ¨¡å‹ï¼ˆModelï¼‰</a></li>\r\n<li>yii\\db\\ActiveRecord</li>\r\n</ul>		</div>', 'Yii2,ActiveRecord', '2', '1443000262', '1443000294', '1');
INSERT INTO `post` VALUES ('36', 'DetailView', '<div id=\"content\">\r\n\r\n<p>yii\\widgets\\DetailView å°éƒ¨ä»¶æ˜¾ç¤ºçš„æ˜¯å•ä¸€ yii\\widgets\\DetailView::$model æ•°æ®çš„è¯¦æƒ…ã€‚</p>\r\n<p>å®ƒéå¸¸é€‚åˆç”¨å¸¸è§„æ ¼å¼æ˜¾ç¤ºä¸€ä¸ªæ¨¡å‹ï¼ˆä¾‹å¦‚åœ¨ä¸€ä¸ªè¡¨æ ¼çš„ä¸€è¡Œä¸­æ˜¾ç¤ºæ¨¡å‹çš„æ¯ä¸ªå±æ€§ï¼‰ã€‚\r\nè¿™é‡Œè¯´çš„æ¨¡å‹å¯ä»¥æ˜¯ \\yii\\base\\Model æˆ–è€…å…¶å­ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œä¾‹å¦‚å­ç±» <a href=\"/doc/guide/2.0/db-active-record\">active record</a>ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå…³è”æ•°ç»„ã€‚</p>\r\n<p>DetailViewä½¿ç”¨ yii\\widgets\\DetailView::$attributes å±æ€§æ¥å†³å®šæ˜¾ç¤ºæ¨¡å‹å“ªäº›å±æ€§ä»¥åŠå¦‚ä½•æ ¼å¼åŒ–ã€‚\r\nå¯ç”¨çš„æ ¼å¼åŒ–é€‰é¡¹ï¼Œè§ <a href=\"/doc/guide/2.0/output-formatting\">formatter section</a> ç« èŠ‚ã€‚</p>\r\n<p>ä¸€ä¸ªå…¸å‹çš„DetailViewçš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-keyword\">echo</span> DetailView::widget([\r\n    <span class=\"hljs-string\">\'model\'</span> =&gt; <span class=\"hljs-variable\">$model</span>,\r\n    <span class=\"hljs-string\">\'attributes\'</span> =&gt; [\r\n        <span class=\"hljs-string\">\'title\'</span>,               <span class=\"hljs-comment\">// title attribute (in plain text)</span>\r\n        <span class=\"hljs-string\">\'description:html\'</span>,    <span class=\"hljs-comment\">// description attribute formatted as HTML</span>\r\n        [                      <span class=\"hljs-comment\">// the owner name of the model</span>\r\n            <span class=\"hljs-string\">\'label\'</span> =&gt; <span class=\"hljs-string\">\'Owner\'</span>,\r\n            <span class=\"hljs-string\">\'value\'</span> =&gt; <span class=\"hljs-variable\">$model</span>-&gt;owner-&gt;name,\r\n        ],\r\n        <span class=\"hljs-string\">\'created_at:datetime\'</span>, <span class=\"hljs-comment\">// creation date formatted as datetime</span>\r\n    ],\r\n]);\r\n</code></pre>\r\n		</div>', 'Yii2,DetailView', '2', '1443001778', '1443001892', '2');
INSERT INTO `post` VALUES ('37', 'ListView', '\r\n<p>yii\\widgets\\ListView å°éƒ¨ä»¶ç”¨äºæ˜¾ç¤ºæ•°æ®æä¾›è€… <a href=\"/doc/guide/2.0/output-data-providers\">data provider</a> æä¾›çš„æ•°æ®ã€‚\r\næ¯ä¸ªæ•°æ®æ¨¡å‹ç”¨æŒ‡å®šçš„è§†å›¾æ–‡ä»¶ yii\\widgets\\ListView::$itemView æ¥æ¸²æŸ“ã€‚\r\nå› ä¸ºå®ƒæä¾›å¼€ç®±å³ç”¨å¼çš„ï¼ˆè¯‘è€…æ³¨ï¼šå°è£…å¥½çš„ï¼‰åˆ†é¡µã€æ’åºä»¥åŠè¿‡æ»¤è¿™æ ·ä¸€äº›ç‰¹æ€§ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ºæœ€ç»ˆç”¨æˆ·æ˜¾ç¤ºä¿¡æ¯å¹¶åŒæ—¶åˆ›å»ºæ•°æ®ç®¡ç†ç•Œé¢ã€‚</p>\r\n<p>ä¸€ä¸ªå…¸å‹çš„ç”¨æ³•å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">widgets</span>\\<span class=\"hljs-title\">ListView</span>;\r\n<span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">data</span>\\<span class=\"hljs-title\">ActiveDataProvider</span>;\r\n\r\n<span class=\"hljs-variable\">$dataProvider</span> = <span class=\"hljs-keyword\">new</span> ActiveDataProvider([\r\n    <span class=\"hljs-string\">\'query\'</span> =&gt; Post::find(),\r\n    <span class=\"hljs-string\">\'pagination\'</span> =&gt; [\r\n        <span class=\"hljs-string\">\'pageSize\'</span> =&gt; <span class=\"hljs-number\">20</span>,\r\n    ],\r\n]);\r\n<span class=\"hljs-keyword\">echo</span> ListView::widget([\r\n    <span class=\"hljs-string\">\'dataProvider\'</span> =&gt; <span class=\"hljs-variable\">$dataProvider</span>,\r\n    <span class=\"hljs-string\">\'itemView\'</span> =&gt; <span class=\"hljs-string\">\'_post\'</span>,\r\n]);\r\n</code></pre>\r\n<p><code>_post</code> è§†å›¾æ–‡ä»¶å¯åŒ…å«å¦‚ä¸‹ä»£ç ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-preprocessor\">&lt;?php</span>\r\n<span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">helpers</span>\\<span class=\"hljs-title\">Html</span>;\r\n<span class=\"hljs-keyword\">use</span> <span class=\"hljs-title\">yii</span>\\<span class=\"hljs-title\">helpers</span>\\<span class=\"hljs-title\">HtmlPurifier</span>;\r\n<span class=\"hljs-preprocessor\">?&gt;</span>\r\n&lt;div <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">post</span>\"&gt;\r\n    &lt;<span class=\"hljs-title\">h2</span>&gt;&lt;?= <span class=\"hljs-title\">Html</span>::<span class=\"hljs-title\">encode</span>($<span class=\"hljs-title\">model</span>-&gt;<span class=\"hljs-title\">title</span>) ?&gt;&lt;/<span class=\"hljs-title\">h2</span>&gt;\r\n    \r\n    &lt;?= <span class=\"hljs-title\">HtmlPurifier</span>::<span class=\"hljs-title\">process</span>($<span class=\"hljs-title\">model</span>-&gt;<span class=\"hljs-title\">text</span>) ?&gt;    \r\n&lt;/<span class=\"hljs-title\">div</span>&gt;\r\n</span></code></pre>\r\n<p>åœ¨ä¸Šé¢çš„è§†å›¾æ–‡ä»¶ä¸­ï¼Œå½“å‰çš„æ•°æ®æ¨¡å‹ <code>$model</code> æ˜¯å¯ç”¨çš„ã€‚å¦å¤–ï¼Œä¸‹é¢çš„è¿™äº›å˜é‡ä¹Ÿæ˜¯å¯ç”¨çš„ï¼š</p>\r\n<ul><li><code>$key</code>ï¼šæ··åˆç±»å‹ï¼Œé”®çš„å€¼ä¸æ•°æ®é¡¹ç›¸å…³è”ã€‚</li>\r\n<li><code>$index</code>ï¼šæ•´å‹ï¼Œæ˜¯ç”±æ•°æ®æä¾›è€…è¿”å›çš„æ•°ç»„ä¸­ä»¥0èµ·å§‹çš„æ•°æ®é¡¹çš„ç´¢å¼•ã€‚</li>\r\n<li><code>$widget</code>ï¼šç±»å‹æ˜¯ListViewï¼Œæ˜¯å°éƒ¨ä»¶çš„å®ä¾‹ã€‚</li>\r\n</ul><p>å‡å¦‚ä½ éœ€è¦ä¼ é€’é™„åŠ æ•°æ®åˆ°æ¯ä¸€ä¸ªè§†å›¾ä¸­ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·ç”¨ yii\\widgets\\ListView::$viewParams å±æ€§ä¼ é€’é”®å€¼å¯¹ï¼š</p>\r\n<pre><code class=\"language-php hljs\"><span class=\"hljs-keyword\">echo</span> ListView::widget([\r\n    <span class=\"hljs-string\">\'dataProvider\'</span> =&gt; <span class=\"hljs-variable\">$dataProvider</span>,\r\n    <span class=\"hljs-string\">\'itemView\'</span> =&gt; <span class=\"hljs-string\">\'_post\'</span>,\r\n    <span class=\"hljs-string\">\'viewParams\'</span> =&gt; [\r\n        <span class=\"hljs-string\">\'fullView\'</span> =&gt; <span class=\"hljs-keyword\">true</span>,\r\n        <span class=\"hljs-string\">\'context\'</span> =&gt; <span class=\"hljs-string\">\'main-page\'</span>,\r\n        <span class=\"hljs-comment\">// ...</span>\r\n    ],\r\n]);\r\n</code></pre>\r\n<p>åœ¨è§†å›¾ä¸­ï¼Œä¸Šè¿°è¿™äº›é™„åŠ æ•°æ®ä¹Ÿæ˜¯å¯ä»¥ä½œä¸ºå˜é‡æ¥ä½¿ç”¨çš„ã€‚</p>\r\n', 'Yii2,ListView', '2', '1443001837', '1443001878', '1');
INSERT INTO `poststatus` VALUES ('1', 'è‰ç¨¿', '1');
INSERT INTO `poststatus` VALUES ('2', 'å·²å‘å¸ƒ', '2');
INSERT INTO `poststatus` VALUES ('3', 'å·²å½’æ¡£', '3');
INSERT INTO `tag` VALUES ('60', 'Yii', '25');
INSERT INTO `tag` VALUES ('61', 'RESTful WebæœåŠ¡', '6');
INSERT INTO `tag` VALUES ('62', 'Yii2', '32');
INSERT INTO `tag` VALUES ('63', 'Gii', '9');
INSERT INTO `tag` VALUES ('64', 'æŸ¥è¯¢æ„å»ºå™¨', '2');
INSERT INTO `tag` VALUES ('65', 'DAO', '8');
INSERT INTO `tag` VALUES ('66', 'GridView', '11');
INSERT INTO `tag` VALUES ('67', 'ListView', '5');
INSERT INTO `tag` VALUES ('68', 'DetailView', '5');
INSERT INTO `tag` VALUES ('69', 'ActiveRecord', '27');
INSERT INTO `tag` VALUES ('70', 'å®‰è£…', '4');
INSERT INTO `tag` VALUES ('71', 'Composer', '4');
INSERT INTO `tag` VALUES ('72', 'å°éƒ¨ä»¶', '1');
INSERT INTO `tag` VALUES ('73', 'widget', '1');
INSERT INTO `tag` VALUES ('74', 'è§†é¢‘æ•™ç¨‹', '1');
INSERT INTO `tag` VALUES ('75', 'æ•™ç¨‹', '1');
INSERT INTO `user` VALUES ('1', 'suran', 'pG7TRyTIXlEbcenpi34TzmMYS2zDsMTF', '$2y$13$HtJqGRmc76KIRIwokii8AOQ1XZljXiuWCKUGFnH9vkTnfBpHtqgFu', null, 'weixi@weixistyle.com', '10', '1462597929', '1527750738');
INSERT INTO `user` VALUES ('2', 'michael', 'xqGDBMlylihvNddSQgDkjAdpJwV4d02C', '$2y$13$bJC0vECI9EPLq/kia9CAmOT060fxoT/HopseOnY.C9siZJDOoQguK', null, 'mchael@163.com', '10', '1475850924', '1475850924');
